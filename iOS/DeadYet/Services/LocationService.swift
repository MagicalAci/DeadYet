//
//  LocationService.swift
//  DeadYet - è¿˜æ²¡æ­»ï¼Ÿ
//

import Foundation
import CoreLocation
import MapKit

@MainActor
class LocationService: NSObject, ObservableObject {
    @Published var currentLocation: CLLocation?
    @Published var currentCity: String?
    @Published var currentDistrict: String?
    @Published var authorizationStatus: CLAuthorizationStatus = .notDetermined
    @Published var errorMessage: String?
    
    private let locationManager = CLLocationManager()
    private let geocoder = CLGeocoder()
    
    override init() {
        super.init()
        locationManager.delegate = self
        locationManager.desiredAccuracy = kCLLocationAccuracyBest
    }
    
    func requestPermission() {
        locationManager.requestWhenInUseAuthorization()
    }
    
    func startUpdatingLocation() {
        locationManager.startUpdatingLocation()
    }
    
    func stopUpdatingLocation() {
        locationManager.stopUpdatingLocation()
    }
    
    private func reverseGeocode(_ location: CLLocation) {
        geocoder.reverseGeocodeLocation(location) { [weak self] placemarks, error in
            guard let self = self else { return }
            
            Task { @MainActor in
                if let error = error {
                    self.errorMessage = error.localizedDescription
                    return
                }
                
                if let placemark = placemarks?.first {
                    self.currentCity = placemark.locality ?? placemark.administrativeArea
                    self.currentDistrict = placemark.subLocality ?? placemark.subAdministrativeArea
                }
            }
        }
    }
}

// MARK: - CLLocationManagerDelegate
extension LocationService: CLLocationManagerDelegate {
    nonisolated func locationManager(_ manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) {
        guard let location = locations.last else { return }
        
        Task { @MainActor in
            self.currentLocation = location
            self.reverseGeocode(location)
        }
    }
    
    nonisolated func locationManager(_ manager: CLLocationManager, didFailWithError error: Error) {
        Task { @MainActor in
            self.errorMessage = error.localizedDescription
        }
    }
    
    nonisolated func locationManagerDidChangeAuthorization(_ manager: CLLocationManager) {
        Task { @MainActor in
            self.authorizationStatus = manager.authorizationStatus
            
            switch manager.authorizationStatus {
            case .authorizedWhenInUse, .authorizedAlways:
                self.startUpdatingLocation()
            case .denied, .restricted:
                self.errorMessage = "éœ€è¦ä½ç½®æƒé™æ‰èƒ½æ˜¾ç¤ºä½ åœ¨å“ªä¸ªåŸå¸‚åŠ ç­"
            default:
                break
            }
        }
    }
}

// MARK: - Mock Data for China Cities
extension LocationService {
    // å…¨å›½ä¸»è¦åŸå¸‚ï¼ˆæ›´ä¸°å¯Œï¼‰
    static let majorCities: [(name: String, lat: Double, lon: Double, tier: Int)] = [
        // ä¸€çº¿åŸå¸‚
        ("åŒ—äº¬", 39.9042, 116.4074, 1),
        ("ä¸Šæµ·", 31.2304, 121.4737, 1),
        ("æ·±åœ³", 22.5431, 114.0579, 1),
        ("å¹¿å·", 23.1291, 113.2644, 1),
        // æ–°ä¸€çº¿åŸå¸‚
        ("æ­å·", 30.2741, 120.1551, 2),
        ("æˆéƒ½", 30.5728, 104.0668, 2),
        ("å—äº¬", 32.0603, 118.7969, 2),
        ("æ­¦æ±‰", 30.5928, 114.3055, 2),
        ("è¥¿å®‰", 34.3416, 108.9398, 2),
        ("è‹å·", 31.2989, 120.5853, 2),
        ("é‡åº†", 29.4316, 106.9123, 2),
        ("å¤©æ´¥", 39.3434, 117.3616, 2),
        ("éƒ‘å·", 34.7466, 113.6254, 2),
        ("é•¿æ²™", 28.2282, 112.9388, 2),
        // äºŒçº¿åŸå¸‚
        ("é’å²›", 36.0671, 120.3826, 3),
        ("æ²ˆé˜³", 41.8057, 123.4315, 3),
        ("æµå—", 36.6512, 117.1201, 3),
        ("å¦é—¨", 24.4798, 118.0894, 3),
        ("ç¦å·", 26.0745, 119.2965, 3),
        ("åˆè‚¥", 31.8206, 117.2272, 3),
        ("å¤§è¿", 38.9140, 121.6147, 3),
        ("æ˜†æ˜", 24.8801, 102.8329, 3),
        ("å“ˆå°”æ»¨", 45.8038, 126.5349, 3),
        ("é•¿æ˜¥", 43.8171, 125.3235, 3),
        ("å—æ˜Œ", 28.6820, 115.8579, 3),
        ("æ— é”¡", 31.4912, 120.3119, 3),
        ("å®æ³¢", 29.8683, 121.5440, 3),
        ("ä¸œè", 23.0208, 113.7518, 3),
        ("ä½›å±±", 23.0218, 113.1218, 3),
        ("è´µé˜³", 26.6470, 106.6302, 3)
    ]
    
    // å„åŸå¸‚çš„åŒºåŸŸ
    static let cityDistricts: [String: [String]] = [
        "åŒ—äº¬": ["æµ·æ·€åŒº", "æœé˜³åŒº", "è¥¿åŸåŒº", "ä¸œåŸåŒº", "ä¸°å°åŒº", "é€šå·åŒº", "å¤§å…´åŒº", "æ˜Œå¹³åŒº"],
        "ä¸Šæµ·": ["æµ¦ä¸œæ–°åŒº", "é»„æµ¦åŒº", "å¾æ±‡åŒº", "é™å®‰åŒº", "é•¿å®åŒº", "è™¹å£åŒº", "æ¨æµ¦åŒº", "é—µè¡ŒåŒº"],
        "æ·±åœ³": ["å—å±±åŒº", "ç¦ç”°åŒº", "ç½—æ¹–åŒº", "å®å®‰åŒº", "é¾™å²—åŒº", "é¾™ååŒº", "å…‰æ˜åŒº", "åªå±±åŒº"],
        "å¹¿å·": ["å¤©æ²³åŒº", "è¶Šç§€åŒº", "æµ·ç åŒº", "ç™½äº‘åŒº", "ç•ªç¦ºåŒº", "é»„åŸ”åŒº", "è”æ¹¾åŒº", "èŠ±éƒ½åŒº"],
        "æ­å·": ["è¥¿æ¹–åŒº", "æ»¨æ±ŸåŒº", "ä½™æ­åŒº", "æ‹±å¢…åŒº", "ä¸ŠåŸåŒº", "è§å±±åŒº", "ä¸´å¹³åŒº", "é’±å¡˜åŒº"],
        "æˆéƒ½": ["æ­¦ä¾¯åŒº", "é”¦æ±ŸåŒº", "é’ç¾ŠåŒº", "é‡‘ç‰›åŒº", "æˆååŒº", "é«˜æ–°åŒº", "å¤©åºœæ–°åŒº", "é¾™æ³‰é©¿åŒº"],
        "å—äº¬": ["ç„æ­¦åŒº", "ç§¦æ·®åŒº", "å»ºé‚ºåŒº", "é¼“æ¥¼åŒº", "æ –éœåŒº", "é›¨èŠ±å°åŒº", "æ±Ÿå®åŒº", "æµ¦å£åŒº"],
        "æ­¦æ±‰": ["æ­¦æ˜ŒåŒº", "æ±Ÿæ±‰åŒº", "æ±‰é˜³åŒº", "æ´ªå±±åŒº", "æ±Ÿå²¸åŒº", "ç¡šå£åŒº", "é’å±±åŒº", "ä¸œæ¹–é«˜æ–°"]
    ]
    
    static func generateMockCityStats() -> [CityStats] {
        majorCities.map { city in
            // ä¸€çº¿åŸå¸‚äººæ•°æ›´å¤š
            let baseTotal: Int
            switch city.tier {
            case 1: baseTotal = Int.random(in: 80000...200000)
            case 2: baseTotal = Int.random(in: 30000...80000)
            default: baseTotal = Int.random(in: 10000...40000)
            }
            
            // æ ¹æ®å½“å‰æ—¶é—´åŠ¨æ€è°ƒæ•´ä¸‹ç­ç‡
            let hour = Calendar.current.component(.hour, from: Date())
            let baseRate: Double
            switch hour {
            case 0..<9: baseRate = Double.random(in: 0.05...0.15)  // å‡Œæ™¨
            case 9..<17: baseRate = Double.random(in: 0.1...0.25)  // ä¸Šç­æ—¶é—´
            case 17..<18: baseRate = Double.random(in: 0.2...0.35) // åˆšåˆ°ä¸‹ç­
            case 18..<19: baseRate = Double.random(in: 0.35...0.55) // æ­£å¸¸ä¸‹ç­
            case 19..<20: baseRate = Double.random(in: 0.5...0.7)  // ç¨æ™šä¸‹ç­
            case 20..<21: baseRate = Double.random(in: 0.6...0.8)  // åŠ ç­ç»“æŸ
            case 21..<22: baseRate = Double.random(in: 0.75...0.9) // æ™šåŠ ç­ç»“æŸ
            default: baseRate = Double.random(in: 0.85...0.95)     // æ·±å¤œ
            }
            
            let checked = Int(Double(baseTotal) * baseRate)
            
            // å¹³å‡ä¸‹ç­æ—¶é—´ï¼šä¸€çº¿åŸå¸‚æ›´æ™š
            let avgTimes: [String]
            switch city.tier {
            case 1: avgTimes = ["20:15", "20:45", "21:00", "21:30", "22:00"]
            case 2: avgTimes = ["19:30", "20:00", "20:30", "21:00", "21:30"]
            default: avgTimes = ["18:30", "19:00", "19:30", "20:00", "20:30"]
            }
            
            return CityStats(
                city: city.name,
                totalWorkers: baseTotal,
                checkedIn: checked,
                stillWorking: baseTotal - checked,
                averageCheckOutTime: avgTimes.randomElement(),
                topComplaint: [
                    "é¢†å¯¼åˆè®©åŠ ç­äº†", "éœ€æ±‚æ”¹äº†ä¸‰é", "å¼€äº†ä¸€å¤©çš„ä¼š",
                    "å·¥èµ„è¿˜æ²¡å‘", "åŒäº‹åˆç”©é”…äº†", "äº§å“åˆæ”¹éœ€æ±‚",
                    "ä»£ç åˆè¦é‡æ„", "æœåŠ¡å™¨åˆå´©äº†", "å®¢æˆ·åˆæŠ•è¯‰äº†"
                ].randomElement(),
                latitude: city.lat,
                longitude: city.lon
            )
        }
    }
    
    static func generateMockComplaints() -> [Complaint] {
        // æ–‡å­—æŠ±æ€¨å†…å®¹ï¼ˆæ›´ä¸°å¯Œï¼‰
        let textComplaints: [(String, String)] = [
            // åŠ ç­ç±» - 30æ¡
            ("é¢†å¯¼è¯´å¼€ä¸ªå¿«ä¼šï¼Œç»“æœå¼€äº†3ä¸ªå°æ—¶ï¼Œæˆ‘äººéƒ½éº»äº†", "åŠ ç­"),
            ("åŠ ç­åˆ°10ç‚¹ï¼ŒåŠ ç­è´¹ä¸€åˆ†æ²¡æœ‰ï¼Œçˆ±è°è°å§", "åŠ ç­"),
            ("å‘¨äº”æ™šä¸Š10ç‚¹æ¥éœ€æ±‚ï¼Œå‘¨ä¸€æ—©ä¸Šè¦ï¼Œè¿™æ˜¯äººèƒ½å¹²çš„äº‹ï¼Ÿ", "åŠ ç­"),
            ("é€šå‹¤2å°æ—¶ï¼Œä¸Šç­8å°æ—¶ï¼ŒåŠ ç­4å°æ—¶ï¼Œç¡è§‰6å°æ—¶ï¼Œè¿™æ˜¯äººè¿‡çš„æ—¥å­ï¼Ÿ", "åŠ ç­"),
            ("åˆæ˜¯å‡Œæ™¨12ç‚¹ä¸‹ç­çš„ä¸€å¤©ï¼Œå‡ºç§Ÿè½¦å¸æœºéƒ½è®¤è¯†æˆ‘äº†", "åŠ ç­"),
            ("è¿ç»­åŠ ç­ä¸¤å‘¨ï¼Œå‘¨æœ«è¿˜è¦åŠ ç­ï¼Œæˆ‘æ˜¯ä¸æ˜¯åº”è¯¥ä½å…¬å¸ï¼Ÿ", "åŠ ç­"),
            ("è¯´å¥½çš„å¼¹æ€§å·¥ä½œåˆ¶ï¼Œç»“æœåªå¼¹ä¸ç¼©ï¼Œæ°¸è¿œåŠ ç­", "åŠ ç­"),
            ("è€æ¿è¯´é¡¹ç›®ç´§æ€¥è¦åŠ ç­ï¼Œé¡¹ç›®éƒ½ç´§æ€¥ä¸‰å¹´äº†", "åŠ ç­"),
            ("ä»Šå¤©åˆæ˜¯æœ€åä¸€ä¸ªèµ°çš„ï¼Œä¿å®‰éƒ½è·Ÿæˆ‘æ··ç†Ÿäº†", "åŠ ç­"),
            ("åŠ ç­åŠ åˆ°å¥³æœ‹å‹è·Ÿæˆ‘åˆ†æ‰‹ï¼Œè¯´æˆ‘çˆ±å·¥ä½œèƒœè¿‡çˆ±å¥¹", "åŠ ç­"),
            ("å‡Œæ™¨ä¸¤ç‚¹è¿˜åœ¨æ”¹bugï¼Œæ˜å¤©è¿˜è¦8ç‚¹å¼€ä¼š", "åŠ ç­"),
            ("å‘¨æœ«åŠ ç­è¿˜è¦è°ƒä¼‘ï¼Œè°ƒä¼‘æ°¸è¿œç”¨ä¸äº†", "åŠ ç­"),
            ("å›½åº†ä¸ƒå¤©ï¼ŒåŠ ç­äº”å¤©ï¼Œæˆ‘æ˜¯å…¬å¸çš„ç‰›é©¬", "åŠ ç­"),
            ("æ™šä¸Š11ç‚¹ä¸‹ç­ï¼Œæ—©ä¸Š8ç‚¹ä¸Šç­ï¼Œæˆ‘æ˜¯æœºå™¨äººå—", "åŠ ç­"),
            ("åŠ ç­åˆ°ç°åœ¨ï¼Œå¤–å–éƒ½ä¸é€äº†ï¼Œåªèƒ½åƒæ³¡é¢", "åŠ ç­"),
            
            // é¢†å¯¼ç±» - 25æ¡
            ("è€æ¿ç”»çš„é¥¼æˆ‘éƒ½èƒ½å¼€é¢åŒ…åº—äº†", "é¢†å¯¼"),
            ("é¢†å¯¼å¼€ä¼šåªä¼šè¯´'å¤§å®¶è¦åŠªåŠ›'ï¼Œä½ å€’æ˜¯åŠªåŠªåŠ›ç»™æˆ‘æ¶¨å·¥èµ„å•Š", "é¢†å¯¼"),
            ("é¢†å¯¼è¯´å¹´åº•åŒè–ªï¼Œç°åœ¨è¯´èµ„é‡‘ç´§å¼ ï¼Œæˆ‘ä¿¡äº†ä»–çš„é‚ª", "é¢†å¯¼"),
            ("é¢†å¯¼æ°¸è¿œéƒ½æ˜¯å¯¹çš„ï¼Œé”™çš„éƒ½æ˜¯æˆ‘ä»¬", "é¢†å¯¼"),
            ("é¢†å¯¼é‚®ä»¶å›å¤åªæœ‰ä¸€ä¸ªå­—ï¼šçŸ¥", "é¢†å¯¼"),
            ("æˆ‘ä»¬é¢†å¯¼æœ€å¤§çš„æœ¬äº‹å°±æ˜¯æŠŠåŠŸåŠ³æ®ä¸ºå·±æœ‰", "é¢†å¯¼"),
            ("é¢†å¯¼è¯´è¦ç»™æˆ‘å‡èŒï¼Œç»“æœåªå‡äº†ä¸€ä¸ªtitleï¼Œå·¥èµ„ä¸å˜", "é¢†å¯¼"),
            ("é¢†å¯¼åˆåœ¨ç¾¤é‡Œ@æ‰€æœ‰äººäº†ï¼Œå¿ƒæ€å´©äº†", "é¢†å¯¼"),
            ("é¢†å¯¼è¯´'è¿™ä¸ªéœ€æ±‚å¾ˆç®€å•'ï¼Œæˆ‘å°±çŸ¥é“å®Œè›‹äº†", "é¢†å¯¼"),
            ("è€æ¿è¯´å…¬å¸æ˜¯å¤§å®¶çš„å®¶ï¼Œé‚£æˆ‘èƒ½å¸¦ç‹—æ¥ä¸Šç­å—", "é¢†å¯¼"),
            ("é¢†å¯¼çš„'æˆ‘è§‰å¾—'æ¯”ç”²æ–¹çš„'æˆ‘è§‰å¾—'è¿˜å¯æ€•", "é¢†å¯¼"),
            ("é¢†å¯¼è¯´å¹´è½»äººè¦å¤šé”»ç‚¼ï¼Œæ‰€ä»¥å¤©å¤©åŠ ç­é”»ç‚¼æˆ‘", "é¢†å¯¼"),
            ("è€æ¿è¯´è¦é™æœ¬å¢æ•ˆï¼Œå…ˆæŠŠæˆ‘ä»¬çš„é›¶é£Ÿå’Œå’–å•¡å–æ¶ˆäº†", "é¢†å¯¼"),
            ("é¢†å¯¼å¼€å®Œä¼šè¯´å¾ˆæ»¡æ„ï¼Œç„¶åå‘äº†ä¸€å †ä¿®æ”¹æ„è§", "é¢†å¯¼"),
            ("é¢†å¯¼æœ€å–œæ¬¢è¯´'æ¢ä½æ€è€ƒ'ï¼Œç„¶åä»ä¸ç«™æˆ‘ä»¬çš„è§’åº¦æƒ³", "é¢†å¯¼"),
            
            // åŒäº‹ç±» - 20æ¡
            ("åŒäº‹æŠŠé”…ç”©ç»™æˆ‘ï¼Œæˆ‘çœŸæ˜¯æœäº†è¿™å¸®å­™å­", "åŒäº‹"),
            ("æ—è¾¹åŒäº‹æ¯å¤©åƒèºè›³ç²‰ï¼Œæˆ‘å¿«çª’æ¯äº†", "åŒäº‹"),
            ("åŒäº‹åˆåœ¨ç¾¤é‡Œå‘æ­£èƒ½é‡æ–‡ç« äº†ï¼Œéº»çƒ¦é—­å˜´", "åŒäº‹"),
            ("åŒäº‹æ€»æ˜¯æŠ¢æˆ‘çš„æ´»å¹²ï¼Œç„¶åæ±‡æŠ¥çš„æ—¶å€™è¯´æ˜¯ä»–åšçš„", "åŒäº‹"),
            ("åŒäº‹è¯·å‡æˆ‘é¡¶ç­ï¼Œæˆ‘è¯·å‡æ²¡äººç®¡", "åŒäº‹"),
            ("æ—è¾¹å·¥ä½çš„åŒäº‹æ¯å¤©æ‰“ç”µè¯å£°éŸ³ç‰¹åˆ«å¤§", "åŒäº‹"),
            ("åŒäº‹æ€»æ˜¯é—®æˆ‘å€Ÿå……ç”µå™¨ï¼Œä»æ¥ä¸è¿˜", "åŒäº‹"),
            ("åŒäº‹èƒŒåè¯´æˆ‘åè¯è¢«æˆ‘å¬åˆ°äº†ï¼Œå°´å°¬æ­»", "åŒäº‹"),
            ("æ–°æ¥çš„åŒäº‹å·¥èµ„æ¯”æˆ‘é«˜ï¼Œæˆ‘å¹²äº†ä¸‰å¹´äº†", "åŒäº‹"),
            ("åŒäº‹æ¯å¤©å‡†ç‚¹ä¸‹ç­ï¼Œæ´»å…¨æ˜¯æˆ‘å¹²çš„", "åŒäº‹"),
            ("åŒäº‹å·åƒäº†æˆ‘çš„é›¶é£Ÿï¼Œè¿˜ä¸æ‰¿è®¤", "åŒäº‹"),
            ("å¼€ä¼šçš„æ—¶å€™åŒäº‹æŠ¢æˆ‘çš„å‘è¨€ï¼Œæ°”æ­»äº†", "åŒäº‹"),
            ("åŒäº‹æ€»æ˜¯åœ¨æˆ‘æ—è¾¹å‰ªæŒ‡ç”²ï¼Œå—ä¸äº†äº†", "åŒäº‹"),
            ("åŠå…¬å®¤æœ‰ä¸ªåŒäº‹æ¯å¤©é¦™æ°´å–·å¤ªå¤šï¼Œå¤´ç–¼", "åŒäº‹"),
            
            // å·¥èµ„ç±» - 20æ¡
            ("å·¥èµ„æ‹–äº†åŠä¸ªæœˆè¿˜æ²¡å‘ï¼Œè¦é¥¿æ­»äº†", "å·¥èµ„"),
            ("è¯•ç”¨æœŸ6ä¸ªæœˆï¼Œè¯´å¥½çš„è½¬æ­£åˆå»¶äº†ï¼Œç”»å¤§é¥¼ä¸“ä¸šæˆ·", "å·¥èµ„"),
            ("è¯´å¥½çš„æ¶¨è–ªï¼Œç»“æœæ¶¨äº†200å—ï¼Œæ‰“å‘å«èŠ±å­å‘¢ï¼Ÿ", "å·¥èµ„"),
            ("å¹´ç»ˆå¥–å‘äº†500å—è´­ç‰©å¡ï¼Œè¿˜åªèƒ½åœ¨å…¬å¸é£Ÿå ‚ç”¨", "å·¥èµ„"),
            ("äº”é™©ä¸€é‡‘æŒ‰æœ€ä½æ ‡å‡†äº¤ï¼Œå·¥èµ„æ¡ä¸€å †æ‰£æ¬¾çœ‹ä¸æ‡‚", "å·¥èµ„"),
            ("åŒè¡Œä¸šåŒå²—ä½ï¼Œæˆ‘ä»¬å…¬å¸å·¥èµ„å€’æ•°ç¬¬ä¸€", "å·¥èµ„"),
            ("ç»©æ•ˆæ°¸è¿œBï¼Œå¥–é‡‘æ°¸è¿œå·®é‚£ä¹ˆä¸€ç‚¹ç‚¹", "å·¥èµ„"),
            ("å·¥èµ„åˆ°æ‰‹è¿˜æ²¡æˆ¿ç§Ÿé«˜ï¼Œæˆ‘åœ¨ç»™æˆ¿ä¸œæ‰“å·¥", "å·¥èµ„"),
            ("è¯´å¥½çš„è‚¡ç¥¨æœŸæƒï¼Œç°åœ¨è¯´å…¬å¸ä¸ä¸Šå¸‚äº†", "å·¥èµ„"),
            ("å¹´ç»ˆå¥–è¯´æ˜¯0-6ä¸ªæœˆï¼Œç»“æœå¤§å®¶éƒ½æ˜¯0", "å·¥èµ„"),
            ("æ¶¨è–ªè·‘ä¸èµ¢é€šèƒ€ï¼Œè¶Šå¹²è¶Šç©·", "å·¥èµ„"),
            ("æ‹›è˜å†™çš„è–ªèµ„èŒƒå›´æ˜¯15-25kï¼Œè¿›æ¥æ‰çŸ¥é“æ˜¯15k", "å·¥èµ„"),
            ("å…¬å¸è¯´ä»Šå¹´æ•ˆç›Šä¸å¥½ï¼Œå¯è€æ¿æ¢äº†è¾†æ–°è½¦", "å·¥èµ„"),
            ("æ¯ä¸ªæœˆå·¥èµ„ä¸€å‘å°±è¿˜èŠ±å‘—ã€è¿˜æˆ¿è´·ï¼Œä¸€åˆ†ä¸å‰©", "å·¥èµ„"),
            
            // å¼€ä¼šç±» - 15æ¡
            ("æ—©ä¸Š9ç‚¹å¼€ä¼šå¼€åˆ°ä¸‹åˆ6ç‚¹ï¼Œå•¥æ´»æ²¡å¹²", "å¼€ä¼š"),
            ("æ¯å¤©å¼€ä¼šå¼€ä¼šå¼€ä¼šï¼Œå·¥ä½œéƒ½æ˜¯åŠ ç­å¹²çš„", "å¼€ä¼š"),
            ("ä¼šè®®çºªè¦å†™äº†30é¡µï¼Œæ²¡æœ‰ä¸€æ¡æ‰§è¡Œçš„", "å¼€ä¼š"),
            ("å¼€ä¼šè®¨è®ºæ€ä¹ˆæé«˜æ•ˆç‡ï¼Œå¼€äº†ä¸€å¤©", "å¼€ä¼š"),
            ("ä¸€å¤©7ä¸ªä¼šï¼Œä¸Šå•æ‰€éƒ½æ²¡æ—¶é—´", "å¼€ä¼š"),
            ("å¼€ä¼šå¼€åˆ°ä¸€åŠï¼Œé¢†å¯¼è¯´'è¿™ä¸ªä¼šä»¥åå†å¼€'", "å¼€ä¼š"),
            ("æ¯å‘¨ä¾‹ä¼šé›·æ‰“ä¸åŠ¨3å°æ—¶ï¼Œå°±ä¸ºäº†æ±‡æŠ¥5åˆ†é’Ÿçš„å·¥ä½œ", "å¼€ä¼š"),
            ("å¼€ä¼šè¿Ÿåˆ°æ‰£é’±ï¼Œå¼€ä¼šè¶…æ—¶æ²¡äººç®¡", "å¼€ä¼š"),
            ("ä¼šè®®å®¤æ°¸è¿œè®¢ä¸åˆ°ï¼Œåªèƒ½ç«™ç€å¼€ä¼š", "å¼€ä¼š"),
            ("å¼€ä¼šå†…å®¹å’Œä¸Šå‘¨ä¸€æ¨¡ä¸€æ ·ï¼Œå¤åˆ¶ç²˜è´´çš„å—", "å¼€ä¼š"),
            ("çº¿ä¸Šä¼šè®®ï¼Œæ€»æœ‰äººä¸å¼€æ‘„åƒå¤´å·å·å¹²åˆ«çš„", "å¼€ä¼š"),
            ("é¢†å¯¼å–œæ¬¢å¼€å®Œä¼šå‘æœ‹å‹åœˆï¼Œé…æ–‡'å›¢é˜Ÿå¾ˆæ£’'", "å¼€ä¼š"),
            
            // äº§å“/éœ€æ±‚ç±» - 20æ¡
            ("éœ€æ±‚åˆæ”¹äº†ï¼Œäº§å“ç»ç†è„‘å­æ˜¯ä¸æ˜¯æœ‰å‘", "å…¶ä»–"),
            ("äº§å“è¯´è¿™ä¸ªéœ€æ±‚å¾ˆç®€å•ï¼Œå°±æ”¹ä¸€ä¸‹ï¼Œæ”¹äº†ä¸‰å¤©", "å…¶ä»–"),
            ("UIç»™çš„è®¾è®¡å›¾æ‰‹æœºä¸Šæ ¹æœ¬æ”¾ä¸ä¸‹ï¼Œè®¾è®¡å¸ˆç”¨çš„2ç±³å¤§å±ï¼Ÿ", "å…¶ä»–"),
            ("æµ‹è¯•æçš„bugæ¯”æˆ‘å†™çš„ä»£ç è¿˜å¤š", "å…¶ä»–"),
            ("ä¸Šçº¿å‰ä¸€å°æ—¶è¯´è¦æ”¹éœ€æ±‚ï¼Œæˆ‘ç›´æ¥åŸåœ°å‡å¤©", "å…¶ä»–"),
            ("éœ€æ±‚æ–‡æ¡£å†™çš„æ˜¯Aï¼Œè¯„å®¡è¯´çš„æ˜¯Bï¼Œä¸Šçº¿è¦æ±‚æ˜¯C", "å…¶ä»–"),
            ("äº§å“è¯´å‚è€ƒç«å“åšï¼Œç«å“æœ‰100ä¸ªäººï¼Œæˆ‘ä»¬å°±3ä¸ª", "å…¶ä»–"),
            ("åŠŸèƒ½è¿˜æ²¡ä¸Šçº¿ï¼Œéœ€æ±‚å·²ç»æ”¹äº†äº”ç‰ˆ", "å…¶ä»–"),
            ("ç”²æ–¹è¯´ä¸æ»¡æ„ï¼Œä½†è¯´ä¸å‡ºå“ªé‡Œä¸æ»¡æ„", "å…¶ä»–"),
            ("ä»£ç å†™å®Œäº†ï¼Œäº§å“è¯´è¿™ä¸ªåŠŸèƒ½ä¸è¦äº†", "å…¶ä»–"),
            ("æµ‹è¯•è¯´æœ‰bugï¼Œä½†åˆå¤ç°ä¸å‡ºæ¥", "å…¶ä»–"),
            ("æ¥å£æ–‡æ¡£å’Œå®é™…å®Œå…¨ä¸ä¸€æ ·ï¼Œåç«¯åœ¨æ•´æˆ‘", "å…¶ä»–"),
            ("è®¾è®¡è¯´æŠ€æœ¯å®ç°ä¸äº†ï¼ŒæŠ€æœ¯è¯´è®¾è®¡åšä¸å‡ºæ¥", "å…¶ä»–"),
            ("è¿è¥è¯´æ•ˆæœä¸å¥½ï¼Œè¦ä¼˜åŒ–ï¼Œä½†ä¸è¯´æ€ä¹ˆä¼˜åŒ–", "å…¶ä»–"),
            
            // å…¶ä»–ç±» - 20æ¡
            ("å…¬å¸ç©ºè°ƒæ°¸è¿œ26åº¦ï¼Œå†¬å¤©å†·æ­»å¤å¤©çƒ­æ­»", "å…¶ä»–"),
            ("ç”µæ¢¯ç­‰äº†20åˆ†é’Ÿï¼Œç›´æ¥çˆ¬20å±‚ç®—äº†", "å…¶ä»–"),
            ("é£Ÿå ‚ä»Šå¤©åˆæ˜¯é‚£å‡ ä¸ªèœï¼Œæˆ‘éƒ½èƒ½èƒŒå‡ºèœå•äº†", "å…¶ä»–"),
            ("å…¬å¸å•æ‰€æ°¸è¿œåœ¨æ‰“æ‰«ï¼Œæ†‹æ­»æˆ‘ç®—äº†", "å…¶ä»–"),
            ("æ‰“å°æœºåˆåäº†ï¼ŒITè¯´æ˜å¤©ä¿®ï¼Œå·²ç»æ˜å¤©äº†ä¸€ä¸ªæœˆ", "å…¶ä»–"),
            ("WiFiåˆæ–­äº†ï¼Œå¹´è´¹å‡ åä¸‡çš„ç½‘ç»œå°±è¿™ï¼Ÿ", "å…¶ä»–"),
            ("å·¥ä½å¤ªå°ï¼Œé”®ç›˜é¼ æ ‡éƒ½æ”¾ä¸ä¸‹", "å…¶ä»–"),
            ("å…¬å¸èŒ¶æ°´é—´çš„å’–å•¡æœºæ°¸è¿œæ’é˜Ÿ", "å…¶ä»–"),
            ("æ˜¾ç¤ºå™¨å¤ªå°ï¼Œçœ¼ç›éƒ½çœ‹çäº†", "å…¶ä»–"),
            ("æ¤…å­åç€è…°ç–¼ï¼Œäººä½“å·¥å­¦æ¤…åªæœ‰é¢†å¯¼æœ‰", "å…¶ä»–"),
            ("å…¬å¸ç»¿æ¤éƒ½æ­»äº†ï¼Œå’Œæˆ‘çš„å¿ƒæƒ…ä¸€æ ·", "å…¶ä»–"),
            ("é—¨ç¦å¡åˆæ¶ˆç£äº†ï¼Œä¿å®‰ä¸è®©è¿›", "å…¶ä»–"),
            ("å…¬å¸çš„å¾®æ³¢ç‚‰å¤ªå°‘ï¼Œçƒ­ä¸ªé¥­æ’é˜Ÿ20åˆ†é’Ÿ", "å…¶ä»–"),
            ("åœè½¦åœºåˆæ»¡äº†ï¼Œåœåœ¨å¤–é¢è¢«è´´æ¡", "å…¶ä»–"),
            ("å…¬å¸çš„çº¸å·¾éƒ½æ˜¯æœ€ä¾¿å®œçš„é‚£ç§ï¼Œåˆ®è„¸", "å…¶ä»–"),
            ("é¥®æ°´æœºçš„æ°´å¿½å†·å¿½çƒ­ï¼Œå–ä¸ªæ°´éƒ½è´¹åŠ²", "å…¶ä»–"),
            ("å·¥ç‰Œç»³å­æ–­äº†ä¸‰æ¬¡äº†ï¼Œè´¨é‡å¤ªå·®", "å…¶ä»–"),
            ("ä¼šè®®å®¤çš„æŠ•å½±ä»ªæ°¸è¿œè¿ä¸ä¸Šï¼Œæ¯æ¬¡éƒ½æµªè´¹15åˆ†é’Ÿ", "å…¶ä»–")
        ]
        
        // è¯­éŸ³æŠ±æ€¨å†…å®¹ï¼ˆè½¬æ–‡å­—åæ˜¾ç¤ºï¼‰
        let voiceComplaints: [(String, String, Int)] = [
            // (è¯­éŸ³è½¬æ–‡å­—å†…å®¹, åˆ†ç±», æ—¶é•¿ç§’)
            ("å•Šæˆ‘çœŸçš„è¦ç–¯äº†ä»Šå¤©é¢†å¯¼è®©æˆ‘æ”¹äº†åéæ–¹æ¡ˆåéå•Šæˆ‘çœŸçš„å—ä¸äº†äº†è¿™æ˜¯äººå¹²çš„äº‹å—", "é¢†å¯¼", 12),
            ("åˆšåˆšå¼€å®Œä¼šä¸‰ä¸ªå°æ—¶å•Šä¸‰ä¸ªå°æ—¶ä»€ä¹ˆéƒ½æ²¡è®¨è®ºå‡ºæ¥æˆ‘çœŸçš„æ— è¯­äº†", "å¼€ä¼š", 8),
            ("åŠ ç­åˆ°ç°åœ¨é¥­éƒ½æ²¡åƒä½ èƒ½ä¿¡å—å¤–å–ä¹Ÿä¸é€äº†æˆ‘åªèƒ½åƒæ³¡é¢", "åŠ ç­", 7),
            ("åŒäº‹åˆç”©é”…ç»™æˆ‘äº†æˆ‘çœŸæ˜¯æœäº†è¿™æ˜¯ç¬¬å‡ æ¬¡äº†å•Š", "åŒäº‹", 5),
            ("å·¥èµ„åˆ°ç°åœ¨è¿˜æ²¡å‘æˆ‘æˆ¿ç§Ÿéƒ½äº¤ä¸èµ·äº†æ€ä¹ˆåŠå•Š", "å·¥èµ„", 6),
            ("ä»Šå¤©éœ€æ±‚åˆæ”¹äº†æ”¹äº†ä¸‰éäº†äº§å“ç»ç†è„‘å­æ˜¯ä¸æ˜¯æœ‰é—®é¢˜å•Š", "å…¶ä»–", 8),
            ("å“...æˆ‘ä¸æƒ³è¯´è¯äº†å¤ªç´¯äº†çœŸçš„å¤ªç´¯äº†", "åŠ ç­", 4),
            ("è¿™ç ´å…¬å¸æˆ‘çœŸçš„å¾…ä¸ä¸‹å»äº†å¤©å¤©åŠ ç­å·¥èµ„åˆä½", "åŠ ç­", 6),
            ("é¢†å¯¼åˆç”»é¥¼äº†è¯´å¹´åº•å‡èŒåŠ è–ªæˆ‘éƒ½å¬äº†ä¸‰å¹´äº†", "é¢†å¯¼", 7),
            ("æµ‹è¯•åˆæäº†ä¸€å †bugæˆ‘å†™çš„ä»£ç çœŸçš„æœ‰é‚£ä¹ˆçƒ‚å—", "å…¶ä»–", 5),
            ("å‡Œæ™¨äº†è¿˜åœ¨å…¬å¸ä½ æ•¢ä¿¡å—æˆ‘éƒ½å¿«çŒæ­»äº†", "åŠ ç­", 5),
            ("å”‰ä»Šå¤©å¿ƒæ€å´©äº†ä»€ä¹ˆéƒ½ä¸æƒ³å¹²äº†", "å…¶ä»–", 3),
            ("è¢«å®¢æˆ·éª‚äº†ä¸€é¡¿çœŸçš„å§”å±ˆæƒ³å“­", "å…¶ä»–", 4),
            ("ä»Šå¤©åˆè¢«é¢†å¯¼ç‚¹åæ‰¹è¯„äº†æˆ‘åšé”™ä»€ä¹ˆäº†", "é¢†å¯¼", 6),
            ("å·¥ä½æ—è¾¹çš„äººæ¯å¤©åƒé‚£ä¸ªè‡­è‡­çš„ä¸œè¥¿æˆ‘çœŸçš„å¿ä¸äº†", "åŒäº‹", 7),
            ("æ—©èµ·èµ¶åœ°é“æŒ¤å¾—æˆ‘éƒ½å–˜ä¸è¿‡æ°”æ¥", "å…¶ä»–", 4),
            ("åˆè¢«æ‹‰å»å›¢å»ºäº†å‘¨æœ«èƒ½ä¸èƒ½è®©æˆ‘ä¼‘æ¯ä¸€ä¸‹", "å…¶ä»–", 5),
            ("é¡¹ç›®åˆå»¶æœŸäº†è¿™æ˜¯ç¬¬å››æ¬¡å»¶æœŸäº†", "å…¶ä»–", 4),
            ("å¼€ä¼šå¼€åˆ°ä¸€åŠé¢†å¯¼è¯´ç®—äº†ä¸‹æ¬¡å†å¼€ä»€ä¹ˆä¸œè¥¿", "å¼€ä¼š", 5),
            ("ç»©æ•ˆåˆæ˜¯Bæˆ‘éƒ½ä¸çŸ¥é“æ€ä¹ˆæ‰èƒ½æ‹¿A", "å·¥èµ„", 5)
        ]
        
        var allComplaints: [Complaint] = []
        
        // ç”Ÿæˆæ–‡å­—æŠ±æ€¨
        for item in textComplaints {
            let city = majorCities.randomElement()!
            let districts = cityDistricts[city.name] ?? ["å¸‚ä¸­å¿ƒ"]
            
            let complaint = Complaint(
                userId: UUID().uuidString,
                userNickname: randomNickname(),
                userEmoji: randomEmoji(),
                content: item.0,
                aiResponse: nil,
                location: Location(
                    latitude: city.lat + Double.random(in: -0.05...0.05),
                    longitude: city.lon + Double.random(in: -0.05...0.05),
                    city: city.name,
                    district: districts.randomElement()
                ),
                createdAt: Date().addingTimeInterval(-Double.random(in: 0...14400)), // 4å°æ—¶å†…
                likes: Int.random(in: 5...3000),
                comments: Int.random(in: 0...300),
                category: Complaint.Category(rawValue: item.1) ?? .general,
                isVoice: false
            )
            allComplaints.append(complaint)
        }
        
        // ç”Ÿæˆè¯­éŸ³æŠ±æ€¨
        for item in voiceComplaints {
            let city = majorCities.randomElement()!
            let districts = cityDistricts[city.name] ?? ["å¸‚ä¸­å¿ƒ"]
            
            let complaint = Complaint(
                userId: UUID().uuidString,
                userNickname: randomNickname(),
                userEmoji: randomEmoji(),
                content: "[è¯­éŸ³æ¶ˆæ¯]", // ç®€ç•¥æ˜¾ç¤º
                aiResponse: nil,
                location: Location(
                    latitude: city.lat + Double.random(in: -0.05...0.05),
                    longitude: city.lon + Double.random(in: -0.05...0.05),
                    city: city.name,
                    district: districts.randomElement()
                ),
                createdAt: Date().addingTimeInterval(-Double.random(in: 0...7200)), // 2å°æ—¶å†…
                likes: Int.random(in: 50...5000), // è¯­éŸ³æ›´å®¹æ˜“è·å¾—ç‚¹èµ
                comments: Int.random(in: 10...500),
                category: Complaint.Category(rawValue: item.1) ?? .general,
                isVoice: true,
                voiceDuration: item.2,
                voiceTranscript: item.0
            )
            allComplaints.append(complaint)
        }
        
        return allComplaints.shuffled()
    }
    
    // éšæœºæ˜µç§°
    private static func randomNickname() -> String {
        [
            "åŒ¿åç‰›é©¬", "åŠ ç­ç‹—", "ç¤¾ç•œä¸€å·", "éŸ­èœæœ¬èœ", "æ‰“å·¥äºº",
            "è‹¦é€¼ç¨‹åºå‘˜", "PPTæˆ˜å£«", "Excelå¤§å¸ˆ", "ä¼šè®®å®¤å¸¸å®¢", "å‘å¾®æ‰“å·¥ä»”",
            "æ‘¸é±¼ä¸“å®¶", "å¸¦è–ªæ‹‰å±", "å·¥èµ„å°å·", "åˆ’æ°´è¾¾äºº", "èŒåœºè€æ²¹æ¡",
            "ç‰›é©¬æœ¬é©¬", "æ¬ç –ä¾ ", "ç å†œæ—¥è®°", "ç¤¾ç•œæ—¥å¸¸", "æ‰“å·¥é­‚",
            "æ•²ä»£ç çš„", "å†™æ–‡æ¡£çš„", "åšè®¾è®¡çš„", "æè¿è¥çš„", "å¹²é”€å”®çš„",
            "åº•å±‚å‘˜å·¥", "æ™®é€šç‰›é©¬", "å¹²é¥­äºº", "å¤œç­æˆ˜å£«", "007é€‰æ‰‹",
            "æ²¡æœ‰å‘¨æœ«", "çŒæ­»é¢„å¤‡", "ç¦»èŒå€’è®¡æ—¶", "åœ¨çº¿å´©æºƒ", "ç²¾ç¥ç¦»èŒ"
        ].randomElement()!
    }
    
    // éšæœºEmojiå¤´åƒ
    private static func randomEmoji() -> String {
        [
            "ğŸ‚", "ğŸ´", "ğŸ•", "ğŸ·", "ğŸ¦Š", "ğŸ±", "ğŸ°", "ğŸ»", "ğŸ¼", "ğŸ¦",
            "ğŸ¯", "ğŸ¸", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¦†", "ğŸ¦‰", "ğŸº", "ğŸ—", "ğŸµ",
            "ğŸ™ˆ", "ğŸ™‰", "ğŸ™Š", "ğŸ¶", "ğŸ²", "ğŸ¦„", "ğŸ™", "ğŸ¦€", "ğŸ¢", "ğŸ"
        ].randomElement()!
    }
}

